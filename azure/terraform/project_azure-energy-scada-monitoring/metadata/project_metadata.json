{
  "project_info": {
    "project_id": "azure-energy-scada-monitoring",
    "project_name": "Smart Grid SCADA Monitoring Platform",
    "description": "A real-time energy grid monitoring system that collects telemetry data from SCADA devices across power substations, processes critical alerts, and provides operational dashboards for grid operators. The system handles high-frequency sensor data from transformers, circuit breakers, and power meters while maintaining strict security isolation and regulatory compliance for critical infrastructure.",
    "cloud_provider": "azure",
    "language": "terraform",
    "architecture_type": "event_driven_iot",
    "business_context": "Regional utility company needs to modernize their grid monitoring infrastructure to meet regulatory requirements for real-time visibility into power distribution networks. The system must handle 10,000+ SCADA points with sub-second latency for critical alarms while maintaining air-gapped security between operational and corporate networks.",
    "components": [
      {
        "name": "iot_hub",
        "service_type": "azure_iothub",
        "purpose": "Secure ingestion of SCADA telemetry data from field devices with device authentication and message routing",
        "dependencies": [],
        "security_considerations": [
          "device_certificate_management",
          "message_encryption",
          "connection_throttling"
        ],
        "configuration_complexity": "high"
      },
      {
        "name": "stream_processor",
        "service_type": "azure_stream_analytics",
        "purpose": "Real-time processing of sensor data to detect anomalies, calculate power flow metrics, and trigger critical alerts",
        "dependencies": [
          "iot_hub",
          "time_series_database"
        ],
        "security_considerations": [
          "data_transformation_validation",
          "output_sanitization"
        ],
        "configuration_complexity": "high"
      },
      {
        "name": "time_series_database",
        "service_type": "azure_data_explorer",
        "purpose": "High-performance storage and querying of historical SCADA data with time-series optimization for trend analysis",
        "dependencies": [],
        "security_considerations": [
          "data_encryption_at_rest",
          "access_control_policies",
          "audit_logging"
        ],
        "configuration_complexity": "medium"
      },
      {
        "name": "alert_processor",
        "service_type": "azure_functions",
        "purpose": "Serverless processing of critical grid alerts with automated notification routing to on-call operators",
        "dependencies": [
          "stream_processor",
          "notification_storage"
        ],
        "security_considerations": [
          "function_isolation",
          "secrets_management",
          "execution_monitoring"
        ],
        "configuration_complexity": "medium"
      },
      {
        "name": "operator_dashboard",
        "service_type": "azure_app_service",
        "purpose": "Web-based SCADA HMI dashboard for grid operators with real-time visualization and control capabilities",
        "dependencies": [
          "time_series_database",
          "notification_storage"
        ],
        "security_considerations": [
          "authentication_integration",
          "session_management",
          "input_validation"
        ],
        "configuration_complexity": "medium"
      },
      {
        "name": "notification_storage",
        "service_type": "azure_storage_account",
        "purpose": "Secure storage of alert logs, operator actions, and compliance audit trails with immutable retention",
        "dependencies": [],
        "security_considerations": [
          "blob_encryption",
          "access_logging",
          "retention_policies"
        ],
        "configuration_complexity": "low"
      }
    ],
    "network_topology": {
      "vpc_structure": "Hub-spoke architecture with dedicated VNET for SCADA operations, isolated from corporate networks with controlled peering",
      "security_zones": [
        "scada_dmz",
        "operations_private",
        "data_tier"
      ],
      "connectivity_patterns": [
        "iot_devices_to_hub_via_vpn",
        "internal_service_mesh",
        "operator_access_via_bastion"
      ]
    },
    "estimated_resources": {
      "compute_instances": 3,
      "storage_accounts": 2,
      "databases": 1,
      "networking_components": 8,
      "iot_services": 2,
      "function_apps": 2,
      "security_components": 4
    },
    "generation_metadata": {
      "agent": "ArchitectureAgent",
      "timestamp": "2025-08-06T22:18:55.191338"
    },
    "vulnerabilities": [
      {
        "rule_id": "AZURE-STORAGE-ENFORCE_HTTPS",
        "title": "Storage Account Missing HTTPS Enforcement",
        "description": "The notification storage account allows unencrypted HTTP traffic, exposing critical SCADA alert logs and audit trails to potential interception during transmission. This violates regulatory requirements for critical infrastructure data protection.",
        "severity": "medium",
        "affected_component": "notification_storage",
        "injection_strategy": "trivy_yaml_injection",
        "business_impact": "Compliance violation and potential exposure of sensitive SCADA operational data during transit",
        "trivy_yaml_content": "terraform:\n  links:\n    - https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/storage_account#enable_https_traffic_only\n  good:\n    - |-\n      resource \"azurerm_storage_account\" \"good_example\" {\n        name                      = \"storageaccountname\"\n        resource_group_name       = azurerm_resource_group.example.name\n        location                  = azurerm_resource_group.example.location\n        account_tier              = \"Standard\"\n        account_replication_type  = \"GRS\"\n        enable_https_traffic_only = true\n      }\n  bad:\n    - |-\n      resource \"azurerm_storage_account\" \"bad_example\" {\n        name                      = \"storageaccountname\"\n        resource_group_name       = azurerm_resource_group.example.name\n        location                  = azurerm_resource_group.example.location\n        account_tier              = \"Standard\"\n        account_replication_type  = \"GRS\"\n        enable_https_traffic_only = false\n      }",
        "file_name": "enforce_https.yaml",
        "service": "storage",
        "provider": "unknown",
        "injection_example": {
          "vulnerable_pattern": "Set enable_https_traffic_only = false in the notification storage account configuration",
          "explanation": "This allows HTTP connections to the storage account containing sensitive SCADA logs and audit data"
        },
        "trivy_rule": true,
        "llm_enhanced": true,
        "source": "llm_selected_trivy_rule"
      },
      {
        "rule_id": "AZURE-APPSERVICE-ENFORCE_HTTPS",
        "title": "Function App Missing HTTPS Enforcement",
        "description": "The alert processor function app allows HTTP connections, creating a vulnerability where critical SCADA alerts could be intercepted or manipulated during transmission between grid monitoring components.",
        "severity": "medium",
        "affected_component": "alert_processor",
        "injection_strategy": "trivy_yaml_injection",
        "business_impact": "Risk of alert tampering or interception affecting critical power grid response times",
        "trivy_yaml_content": "terraform:\n  links:\n    - https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/function_app#https_only\n  good:\n    - |-\n      resource \"azurerm_function_app\" \"good_example\" {\n        name                       = \"test-azure-functions\"\n        location                   = azurerm_resource_group.example.location\n        resource_group_name        = azurerm_resource_group.example.name\n        app_service_plan_id        = azurerm_app_service_plan.example.id\n        storage_account_name       = azurerm_storage_account.example.name\n        storage_account_access_key = azurerm_storage_account.example.primary_access_key\n        os_type                    = \"linux\"\n        https_only                 = true\n      }\n  bad:\n    - |-\n      resource \"azurerm_function_app\" \"bad_example\" {\n        name                       = \"test-azure-functions\"\n        location                   = azurerm_resource_group.example.location\n        resource_group_name        = azurerm_resource_group.example.name\n        app_service_plan_id        = azurerm_app_service_plan.example.id\n        storage_account_name       = azurerm_storage_account.example.name\n        storage_account_access_key = azurerm_storage_account.example.primary_access_key\n        os_type                    = \"linux\"\n      }",
        "file_name": "enforce_https.yaml",
        "service": "appservice",
        "provider": "unknown",
        "injection_example": {
          "vulnerable_pattern": "Omit the https_only = true parameter in the function app configuration",
          "explanation": "Without HTTPS enforcement, the function app accepts HTTP connections, exposing alert processing to man-in-the-middle attacks"
        },
        "trivy_rule": true,
        "llm_enhanced": true,
        "source": "llm_selected_trivy_rule"
      },
      {
        "rule_id": "AZURE-STORAGE-DEFAULT_ACTION_DENY",
        "title": "Storage Account Network Rules Too Permissive",
        "description": "The notification storage account has overly permissive network access rules, allowing unrestricted access to critical SCADA audit logs and alert data instead of implementing proper network segmentation for critical infrastructure.",
        "severity": "medium",
        "affected_component": "notification_storage",
        "injection_strategy": "trivy_yaml_injection",
        "business_impact": "Unauthorized access to sensitive grid operational data from untrusted networks",
        "trivy_yaml_content": "terraform:\n  links:\n    - https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/storage_account_network_rules#default_action\n  good:\n    - |-\n      resource \"azurerm_storage_account_network_rules\" \"good_example\" {\n\n        default_action             = \"Deny\"\n        ip_rules                   = [\"127.0.0.1\"]\n        virtual_network_subnet_ids = [azurerm_subnet.test.id]\n        bypass                     = [\"Metrics\"]\n      }\n  bad:\n    - |-\n      resource \"azurerm_storage_account_network_rules\" \"bad_example\" {\n\n        default_action             = \"Allow\"\n        ip_rules                   = [\"127.0.0.1\"]\n        virtual_network_subnet_ids = [azurerm_subnet.test.id]\n        bypass                     = [\"Metrics\"]\n      }",
        "file_name": "default_action_deny.yaml",
        "service": "storage",
        "provider": "unknown",
        "injection_example": {
          "vulnerable_pattern": "Set default_action = \"Allow\" in storage account network rules",
          "explanation": "This allows access from any network instead of restricting to authorized SCADA network segments"
        },
        "trivy_rule": true,
        "llm_enhanced": true,
        "source": "llm_selected_trivy_rule"
      },
      {
        "rule_id": "AZURE-APPSERVICE-ACCOUNT_IDENTITY_REGISTERED",
        "title": "App Service Missing Managed Identity",
        "description": "The operator dashboard lacks managed identity configuration, forcing the use of connection strings and access keys for authentication to the time-series database, creating credential exposure risks in the SCADA environment.",
        "severity": "medium",
        "affected_component": "operator_dashboard",
        "injection_strategy": "trivy_yaml_injection",
        "business_impact": "Increased risk of credential compromise affecting grid operator access to critical monitoring data",
        "trivy_yaml_content": "terraform:\n  links:\n    - https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/app_service#identity\n  good:\n    - |-\n      resource \"azurerm_app_service\" \"good_example\" {\n        name                = \"example-app-service\"\n        location            = azurerm_resource_group.example.location\n        resource_group_name = azurerm_resource_group.example.name\n        app_service_plan_id = azurerm_app_service_plan.example.id\n\n        identity {\n          type         = \"UserAssigned\"\n          identity_ids = \"webapp1\"\n        }\n      }\n  bad:\n    - |-\n      resource \"azurerm_app_service\" \"bad_example\" {\n        name                = \"example-app-service\"\n        location            = azurerm_resource_group.example.location\n        resource_group_name = azurerm_resource_group.example.name\n        app_service_plan_id = azurerm_app_service_plan.example.id\n      }",
        "file_name": "account_identity_registered.yaml",
        "service": "appservice",
        "provider": "unknown",
        "injection_example": {
          "vulnerable_pattern": "Omit the identity block in the app service configuration",
          "explanation": "Without managed identity, the dashboard must use stored credentials, increasing the attack surface"
        },
        "trivy_rule": true,
        "llm_enhanced": true,
        "source": "llm_selected_trivy_rule"
      },
      {
        "rule_id": "AZURE-MONITOR-ACTIVITY_LOG_RETENTION_SET",
        "title": "Insufficient Activity Log Retention",
        "description": "Azure Monitor activity log retention is set below regulatory requirements for critical infrastructure, potentially causing compliance violations and loss of audit trails needed for incident investigation in SCADA environments.",
        "severity": "medium",
        "affected_component": "time_series_database",
        "injection_strategy": "trivy_yaml_injection",
        "business_impact": "Regulatory compliance failure and insufficient audit trail for security incident investigation",
        "trivy_yaml_content": "terraform:\n  links:\n    - https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/monitor_log_profile#retention_policy\n  good:\n    - |-\n      resource \"azurerm_monitor_log_profile\" \"good_example\" {\n        name = \"good_example\"\n\n        retention_policy {\n          enabled = true\n          days    = 365\n        }\n      }\n  bad:\n    - |-\n      resource \"azurerm_monitor_log_profile\" \"bad_example\" {\n        name = \"bad_example\"\n\n        retention_policy {\n          enabled = true\n        }\n      }\n    - |-\n      resource \"azurerm_monitor_log_profile\" \"bad_example\" {\n        name = \"bad_example\"\n\n        retention_policy {\n          enabled = true\n          days    = 7\n        }\n      }",
        "file_name": "activity_log_retention_set.yaml",
        "service": "monitor",
        "provider": "unknown",
        "injection_example": {
          "vulnerable_pattern": "Set retention days to 7 or omit the days parameter entirely",
          "explanation": "Short retention periods fail to meet regulatory requirements for critical infrastructure audit logging"
        },
        "trivy_rule": true,
        "llm_enhanced": true,
        "source": "llm_selected_trivy_rule"
      },
      {
        "rule_id": "AZURE-KEYVAULT-ENSURE_SECRET_EXPIRY",
        "title": "Key Vault Secrets Without Expiration",
        "description": "Secrets stored in Key Vault for SCADA device certificates and connection strings lack expiration dates, creating long-term credential exposure risks that violate security best practices for critical infrastructure.",
        "severity": "medium",
        "affected_component": "iot_hub",
        "injection_strategy": "trivy_yaml_injection",
        "business_impact": "Long-lived credentials increase risk of compromise and unauthorized SCADA device access",
        "trivy_yaml_content": "terraform:\n  links:\n    - https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/key_vault_secret#expiration_date\n  good:\n    - |-\n      resource \"azurerm_key_vault_secret\" \"good_example\" {\n        name            = \"secret-sauce\"\n        value           = \"szechuan\"\n        key_vault_id    = azurerm_key_vault.example.id\n        expiration_date = \"1982-12-31T00:00:00Z\"\n      }\n  bad:\n    - |-\n      resource \"azurerm_key_vault_secret\" \"bad_example\" {\n        name         = \"secret-sauce\"\n        value        = \"szechuan\"\n        key_vault_id = azurerm_key_vault.example.id\n      }",
        "file_name": "ensure_secret_expiry.yaml",
        "service": "keyvault",
        "provider": "unknown",
        "injection_example": {
          "vulnerable_pattern": "Omit the expiration_date parameter in Key Vault secret resources",
          "explanation": "Secrets without expiration dates remain valid indefinitely, increasing the window for potential compromise"
        },
        "trivy_rule": true,
        "llm_enhanced": true,
        "source": "llm_selected_trivy_rule"
      },
      {
        "rule_id": "AZURE-SECURITYCENTER-SET_REQUIRED_CONTACT_DETAILS",
        "title": "Missing Security Center Contact Information",
        "description": "Azure Security Center lacks proper contact details for security alerts, potentially delaying incident response for critical SCADA infrastructure security events that require immediate attention from grid operators.",
        "severity": "medium",
        "affected_component": "alert_processor",
        "injection_strategy": "trivy_yaml_injection",
        "business_impact": "Delayed security incident response affecting critical power grid infrastructure protection",
        "trivy_yaml_content": "terraform:\n  links:\n    - https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/security_center_contact#phone\n  good:\n    - |-\n      resource \"azurerm_security_center_contact\" \"good_example\" {\n        email = \"good_contact@example.com\"\n        phone = \"+1-555-555-5555\"\n\n        alert_notifications = true\n        alerts_to_admins    = true\n      }\n  bad:\n    - |-\n      resource \"azurerm_security_center_contact\" \"bad_example\" {\n        email = \"bad_contact@example.com\"\n        phone = \"\"\n\n        alert_notifications = true\n        alerts_to_admins    = true\n      }",
        "file_name": "set_required_contact_details.yaml",
        "service": "securitycenter",
        "provider": "unknown",
        "injection_example": {
          "vulnerable_pattern": "Set phone parameter to empty string in Security Center contact configuration",
          "explanation": "Missing contact details prevent proper security alert routing for critical infrastructure incidents"
        },
        "trivy_rule": true,
        "llm_enhanced": true,
        "source": "llm_selected_trivy_rule"
      }
    ],
    "vulnerability_metadata": {
      "total_count": 7,
      "trivy_rules_used": [
        "AZURE-STORAGE-ENFORCE_HTTPS",
        "AZURE-APPSERVICE-ENFORCE_HTTPS",
        "AZURE-STORAGE-DEFAULT_ACTION_DENY",
        "AZURE-APPSERVICE-ACCOUNT_IDENTITY_REGISTERED",
        "AZURE-MONITOR-ACTIVITY_LOG_RETENTION_SET",
        "AZURE-KEYVAULT-ENSURE_SECRET_EXPIRY",
        "AZURE-SECURITYCENTER-SET_REQUIRED_CONTACT_DETAILS"
      ],
      "severity_distribution": {
        "critical": 0,
        "high": 0,
        "medium": 7,
        "low": 0
      },
      "service_categories": [
        "storage",
        "appservice",
        "monitor",
        "securitycenter",
        "keyvault"
      ],
      "services_covered": [
        "storage",
        "appservice",
        "monitor",
        "securitycenter",
        "keyvault"
      ],
      "trivy_integration": true,
      "llm_selected": true
    }
  },
  "generation_info": {
    "extraction_method": "block_marker_parsing",
    "source": "llm_response",
    "project_id": "azure-energy-scada-monitoring",
    "total_resources": 25,
    "resource_breakdown": {
      "azurerm_resource_group": 1,
      "azurerm_virtual_network": 1,
      "azurerm_subnet": 2,
      "azurerm_network_security_group": 1,
      "azurerm_key_vault": 1,
      "azurerm_key_vault_secret": 1,
      "random_string": 1,
      "azurerm_iothub": 1,
      "azurerm_storage_account": 1,
      "azurerm_storage_account_network_rules": 1,
      "azurerm_storage_container": 1,
      "azurerm_kusto_cluster": 1,
      "azurerm_kusto_database": 1,
      "azurerm_service_plan": 1,
      "azurerm_linux_function_app": 1,
      "azurerm_linux_web_app": 1,
      "azurerm_stream_analytics_job": 1,
      "azurerm_monitor_log_profile": 1,
      "azurerm_security_center_contact": 1,
      "data_azurerm_client_config": 1
    },
    "components_implemented": {
      "iot_hub": "azurerm_iothub.scada_iot_hub",
      "stream_processor": "azurerm_stream_analytics_job.stream_processor",
      "time_series_database": "azurerm_kusto_cluster.time_series_database + azurerm_kusto_database.scada_telemetry_db",
      "alert_processor": "azurerm_linux_function_app.alert_processor",
      "operator_dashboard": "azurerm_linux_web_app.operator_dashboard",
      "notification_storage": "azurerm_storage_account.notification_storage"
    },
    "vulnerabilities_injected": 7,
    "estimated_deployment_time": "15-20 minutes",
    "estimated_monthly_cost": "$800-1200 USD",
    "compliance_frameworks": [
      "NERC CIP",
      "IEC 62443",
      "NIST Cybersecurity Framework"
    ],
    "deployment_complexity": "High - Critical Infrastructure"
  },
  "file_structure": [],
  "trivy_integration": {},
  "validation_summary": {
    "component_coverage": 1.0,
    "resource_count": 20,
    "components_implemented": 6,
    "components_missing": 0,
    "recommendations": []
  }
}